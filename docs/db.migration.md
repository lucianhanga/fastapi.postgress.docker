# How to Migrate a Database Table
# ===============================

## Step 1. Create a new migration file using the following command:

Generate a new Alembic migration to add the "description" column to the "users" table:

```bash
alembic revision --autogenerate -m "Add description column to users table"
```

## Step 2. Edit the generated migration script

Edit the generated migration script to add the new column to the "users" table:

```python

# revision identifiers, used by Alembic.
revision: str = '05e80bef822c'
down_revision: Union[str, None] = None

# ...

def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('users', sa.Column('description', sa.String(), nullable=True))
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('users', 'description')
    # ### end Alembic commands ###
```

## Step 3. Update the database schema

In the db/schemas/user_schema.py file, add the new "description" field to the User schema:

```python
class UserBase(BaseModel):
    email: EmailStr
    name: str
    description: Optional[str] = None # This is the new field
```


## Step 4. Update the API endpoint
```python

# ...
    new_user = User(
        email=user.email,
        name=user.name,
        description=user.description  # New field
    )
# ...

```

## Step 5. Apply the migration

Apply the migration to the database using the following command:

```bash
alembic upgrade head
```

or from the docker container:

```bash
docker-compose exec web alembic upgrade head
```

That's it! You have successfully migrated the database table to add a new column.


